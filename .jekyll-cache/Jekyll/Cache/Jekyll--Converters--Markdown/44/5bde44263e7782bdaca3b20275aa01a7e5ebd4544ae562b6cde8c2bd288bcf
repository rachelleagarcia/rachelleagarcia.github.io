I"ˇ1<p>As a part of the web application series, I will be using Juice Shop. Juice Shop is an unsecure web application created by Bjorn Kimminich. It contains OWASP‚Äôs Top Ten vulnerabilities and many other security flaws found in real-world applications.</p>

<p>You can read more about OWASP Juice Shop here: <a href="https://owasp.org/www-project-juice-shop/">OWASP Juice Shop</a></p>

<p>In this post we‚Äôll be going through one of the OWASP Top Ten vulnerabilities, Injection, using Juice Shop to show what it looks like and how we can defend our web applications against these types of attacks.</p>

<h2 id="introduction">Introduction</h2>

<p>Before we start, OWASP has a great article that goes over Injection: <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A1-Injection">OWASP: Injection</a></p>

<p>Essentially, Injection is when an attacker can send data to an interpreter to gain sensitive information. An example of an Injection attack is SQL injection, which is what we‚Äôll be using in Juice Shop.</p>

<h2 id="the-setup">The Setup</h2>

<p>First, we‚Äôll need to install Juice Shop. Here‚Äôs GitHub link that will show you how to install it:</p>

<p><a href="https://github.com/bkimminich/juice-shop#from-sources">OWASP Juice Shop</a></p>

<p>We‚Äôll also need Burp Suite which should already be installed in Kali. Burp Suite is a web application security software. There is a community edition that‚Äôs available for free, or you can pay for the Pro edition which gives you more features. In this scenario, I‚Äôll be using the community edition:</p>

<p><a href="https://portswigger.net/burp">Burp Suite by PortSwigger</a></p>

<p>Lastly, here‚Äôs the Gitbook that has a list of Injection challenges that we‚Äôll be completing. There‚Äôs also some helpful tips in each challenge that Bjorn mentions.</p>

<p><a href="https://bkimminich.gitbooks.io/pwning-owasp-juice-shop/part2/injection.html">Injection Challenges - Juice Shop</a></p>

<p>Once you have all of these tools ready, we can get started.</p>

<h2 id="two-star-challenges">Two Star Challenges</h2>

<h3 id="login-admin">Login Admin</h3>

<ul>
  <li>Description: Log in with the administrator‚Äôs user account</li>
</ul>

<p>The first thing we can do is attempt to login to Juice Shop while having Burp Suite open. We can enter in something random for our initial login attempt:</p>

<ul>
  <li>username: admin</li>
  <li>password: password</li>
</ul>

<p>Since Burp Suite was open, we can collect the HTTP Request in the Proxy tab, and if we right-click, we can send it to the Repeater.</p>

<p><img src="/images/blog/injection/admin.jpg" alt="burp suite admin login" /></p>

<p>Now, if we head into the Repeater tab and press the Send button, we get a response that says authentication denied. Let‚Äôs see if we can add SQL to it to bypass the login authentication to gain admin access.</p>

<p>So instead of ‚Äúadmin‚Äù let‚Äôs type in ‚Äúadmin‚Äô or 1=1‚Äì‚Äù in the Request section.</p>

<p><img src="/images/blog/injection/adminrequest.jpg" alt="submitting a request through burp suite" /></p>

<p>Now, if we press send‚Ä¶ it worked! We now have access to the admin account. We can also see the admin‚Äôs email address <strong>admin@juice-sh.op</strong> at the bottom of the Response section too which may come in handy later.</p>

<p>Why did this work? Well, by adding:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">'</code> = it allows us to inject SQL commands.</li>
  <li><code class="language-plaintext highlighter-rouge">or 1=1</code> = means or True.</li>
  <li><code class="language-plaintext highlighter-rouge">--</code> = will comment out the rest of the code.</li>
</ul>

<p>In other words, because the username is defined as <em>True</em> and it ignored the password field for authentication, we were allowed to login in as admin.</p>

<h2 id="three-star-challenges">Three Star Challenges</h2>

<h3 id="login-benderjim">Login Bender/Jim</h3>

<ul>
  <li>Description: Log in with Bender‚Äôs (or Jim‚Äôs) user account</li>
</ul>

<p><em>FYI, the steps below work for either Bender or Jim‚Äôs account, but for example purposes, I will be attempting to login to Bender‚Äôs account.</em></p>

<p>One of the tips that Bjorn mentions is that the email address is similar to the admin‚Äôs email address (admin@juice-sh.op). So, it‚Äôs possible that Bender‚Äôs email address is bender@juice-sh.op.</p>

<p>We can follow the similar steps in the Login Admin challenge, and edit the username field in the Request section, but this time add <code class="language-plaintext highlighter-rouge">'--</code> at the end, so that it looks like:</p>

<p><code class="language-plaintext highlighter-rouge">"bender@juice-sh.op--"</code></p>

<p><img src="/images/blog/injection/bender.jpg" alt="login attempt for benders account" /></p>

<p>And if we press the Send button again, it worked! We get a success message back in the Response section, so now we also have access to Bender‚Äôs account. If you want, you can repeat the same steps to gain access to Jim‚Äôs account too.</p>

<h3 id="christmas-special">Christmas Special</h3>

<ul>
  <li>Description: Order the Christmas special offer of 2014</li>
</ul>

<p>Since the Christmas special is hidden, we can try to search for it within the database. But.. we have to find it first, so let‚Äôs see if we have any luck with the search bar while running Burp Suite.</p>

<p>When we search for something in Juice Shop, we see the HTTP Request in Burp Suite:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>GET /rest/products/search?q= 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If we right-click, send this to the Reapeter, add a <code class="language-plaintext highlighter-rouge">'</code> after the <code class="language-plaintext highlighter-rouge">q=</code> and press send, we can see the Response:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{"status":"success","data":[]}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>A secure web application would not have provided us with a success status, but because it did, we can try adding additional SQL to complete this challenge.</p>

<p>So if we enter in <code class="language-plaintext highlighter-rouge">'))--</code> we might be able to get a response that shows us everything within the database‚Ä¶ and it did! Why? Because we‚Äôre changing the SQL query to say:</p>

<p>‚ÄúSELECT * FROM Products WHERE ((name LIKE ‚Äò%<strong>‚Äô))‚Äî-</strong></p>

<p>Meaning, <code class="language-plaintext highlighter-rouge">'))</code> closes the original query and <code class="language-plaintext highlighter-rouge">--</code> commented out the rest of it.</p>

<p>This is why the response gave us a list of all the products listed in the database.</p>

<p>Now that we can see all of the products, we can search for the word ‚ÄúChristmas‚Äù to locate the Christmas special. Note that the ID number is 10.</p>

<p><img src="/images/blog/injection/christmas.jpg" alt="searching for christmas special" /></p>

<p>If we go back into the Juice Shop and add a random item, like an Apple, to the cart but change the ID number in Burp Suite to 10, we might be able to replace the Apple with the Christmas special instead.</p>

<p><img src="/images/blog/injection/productid.png" alt="searching for christmas special" /></p>

<p>Look at that! We now have the Christmas special added to our shopping basket.</p>

<p><img src="/images/blog/injection/basket.png" alt="added christmas special to basket" /></p>

<h3 id="database-schema">Database Schema</h3>

<ul>
  <li>Description: Exfiltrate the entire DB schema definition via SQL Injection</li>
</ul>

<p>In the Christmas special, we found out that we can add parameters after the <code class="language-plaintext highlighter-rouge">q</code>, and if we play around with the parameters and entered something where the output would produce errors, the output would also display that we are using an SQL database called SQLite.</p>

<p>SQLite uses a database schema that is stored in a table called sqlite_master.</p>

<blockquote>
  <p>Every SQLite database has an SQLITE_MASTER table that defines the schema for the database.</p>
</blockquote>

<p>Read more about SQLite here: <a href="https://www.sqlite.org/faq.html#q7">SQLite FAQs</a></p>

<p>Meaning, if we edited the Request to <code class="language-plaintext highlighter-rouge">')) UNION SELECT * FROM sqlite_master--</code> and sent the Request in Burp Suite, the Response area tells us that there is an error:</p>

<p><img src="/images/blog/injection/dbschema.png" alt="SQL error" /></p>

<p>This means that to get a successful response back, we need to enter the same number of columns in the database. Let‚Äôs give this a try.</p>

<p>We can start adding columns one by one, spoiler alert.. the answer is going to be 9, so by the time you‚Äôve reached 9, it should look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>')) UNION SELECT '1', '2', '3', '4', '5', '6', '7', '8', '9' FROM sqlite_master--
</pre></td></tr></tbody></table></code></pre></div></div>

<p>And in the Response area, we should get a successful query.</p>

<p><img src="/images/blog/injection/success.png" alt="success attempt to access database" /></p>

<p>Next, we‚Äôll want to remove the unwanted product results by adding <code class="language-plaintext highlighter-rouge">qwert</code> and change the <code class="language-plaintext highlighter-rouge">1</code> value with <code class="language-plaintext highlighter-rouge">sql</code> so that we get the original table. The final result should look something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>qwert')) UNION SELECT sql, '2', '3', '4', '5', '6', '7', '8', '9' FROM sqlite_master--
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>Why sql? The sql field is the text of the original CREATE TABLE or CREATE INDEX statement that created the table or index.</p>
</blockquote>

<p>And if we press the Send button in Burp Suite, we should get the original table.. and we did!</p>

<p><img src="/images/blog/injection/finaldbschema.png" alt="completed dbschema challenge" /></p>

<p>Another challenge completed.</p>

<h2 id="four-star-challenges">Four Star Challenges</h2>

<h3 id="user-credentials">User Credentials</h3>

<ul>
  <li>Description: Retrieve a list of all user credentials via SQL Injection.</li>
</ul>

<p>This challenge is very similar to how attackers can gain sensitive information from a database if the sytem is vulnerable to SQL injection.</p>

<p>In the Database Schema challenge, we found out that the <code class="language-plaintext highlighter-rouge">q</code> paramter is suspectable to SQL injection. As a result, we can use a similar payload but alter it slightly so that we‚Äôre pulling data from the Users table:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>qwert')) UNION SELECT sql, '2', '3', '4', '5', '6', '7', '8', '9' FROM Users--
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Next, we‚Äôll want to replace the fixed values with the correct column names. We can either guess them or remember them from previous SQL errors when we were attacking the Login form.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>qwert')) UNION SELECT id, email, password, '4', '5', '6', '7', '8', '9' FROM Users--
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Once we click the Send button, we should get the response:</p>

<p><img src="/images/blog/injection/userlist.jpg" alt="completed dbschema challenge" /></p>

<p>There we go! We did it, a list of all the users and their passwords.</p>

:ET